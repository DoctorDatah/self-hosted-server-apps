# Cloudflare Tunnel (VM)

Flat, self-contained setup to run Cloudflare Tunnel on a VM via Docker Compose.

## Quick Steps (Do This)
- Clone the repo to the VM (first time only) (pull later)
- Create the tunnel in Cloudflare and copy the token
- Export `CLOUDFLARE_TUNNEL_TOKEN` in your VM shell
- Update `config.yml` with your hostname(s) and service target(s)
- Run `./install.sh` and select tags if prompted
- Verify with `./logs.sh`

## Files (Hierarchy)
```
.
├─ docker-compose.yml                  # cloudflared service
├─ config.yml                          # ingress config template (no secrets)
├─ config.generated.yml                # generated by install.sh when tag selection is used
├─ requirements.txt                    # pinned cloudflared image tag
├─ install.sh                          # start the tunnel (prompts for tag selection)
├─ logs.sh                             # follow logs
├─ vm-requirements.txt                 # pinned Docker packages for the VM
└─ Step by Step Installation \ Setup Guide
   ├─ 1. repo-clone-guide.md           # clone/update the repo on the VM
   ├─ 2. cloudflare-tunnel-creation-guide.md
   ├─ 3. cloudflare-install-guide.md
   ├─ 4. [In self hosted app config]  cloudflare-to-app-network-guide.md
   └─ 5. cloudflare-troubleshooting-guide.md
```

## Usage (on the VM)
```bash
export CLOUDFLARE_TUNNEL_TOKEN="your_token_here"
./install.sh
./logs.sh
```

## What install.sh does
- Checks Docker + Compose (installs if missing unless `--skip-docker`)
- Prompts for tag selection and generates `config.generated.yml` if chosen
- Reads pinned image/tag from `requirements.txt` (can override tag)
- Starts the tunnel container with Docker Compose

## Notes
- Update `config.yml` with your hostname(s) and service target(s).
- `install.sh` can filter `config.yml` by tag blocks and write `config.generated.yml`.
- `CLOUDFLARE_TUNNEL_TOKEN` must be exported in the shell session.
