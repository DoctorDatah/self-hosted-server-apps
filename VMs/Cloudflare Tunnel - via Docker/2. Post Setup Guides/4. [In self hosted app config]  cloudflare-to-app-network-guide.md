# Cloudflare Tunnel -> App Container Network Guide

Use this when cloudflared runs in one container and your app runs in another container/stack.

## Goal
Let cloudflared reach the app over Docker networking so the tunnel serves the app.

---

## 1) Ensure your app is on a dedicated network
Most apps already use their own compose network (e.g., `coolify`, `n8n`, or `<project>_default`).

If you need to create one:
```bash
docker network create coolify
```

---

## 2) Attach your app container to that network
In the app’s `docker-compose.yml`:
```yaml
networks:
  coolify:
    external: true

services:
  app:
    networks:
      - coolify
```
Replace `coolify` with your app’s network name and `app` with your app service name if different.

---

## 3) Attach cloudflared to the same network (via install.sh)
When you run `install.sh`, it prompts:
```
Docker network for target app [coolify]:
```
Enter your app’s network name (e.g., `coolify`, `n8n`, or `<project>_default`).

---

## 4) Point the tunnel to the app container
In `VMs/Cloudflare Tunnel - via Docker/config.yml`:
```yaml
ingress:
  - hostname: app.example.com
    service: http://app:PORT
  - service: http_status:404
```
Use:
- `app` = the app container name (service name in compose)
- `PORT` = the app’s internal port

---

## 5) Verify
From the VM:
```bash
docker network inspect coolify | grep -E 'Name|Containers'
```
You should see both the app container and cloudflared attached to the same network.

---

## Common mistakes
- **Different networks:** cloudflared can’t resolve the app container name.
- **Wrong container name:** use the compose service name, not the image name.
- **Wrong port:** use the app’s internal port, not host-mapped port.
