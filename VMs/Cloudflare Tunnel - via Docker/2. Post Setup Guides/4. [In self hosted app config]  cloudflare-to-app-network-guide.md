# Cloudflare Tunnel -> App Container Network Guide

Use this when cloudflared runs in one container and your app runs in another container/stack.

## Goal
Let cloudflared reach the app over Docker networking so the tunnel serves the app.

---

## 1) Ensure your app is on the shared network
Use the shared `appnet` network created by `VMs/0. Installations`.

If you need to create one:
```bash
docker network create appnet
```

---

## 2) Attach your app container to that network
In the app’s `docker-compose.yml`:
```yaml
networks:
  appnet:
    external: true

services:
  app:
    networks:
      - appnet
```
Replace `appnet` with your network name and `app` with your app service name if different.

---

## 3) Attach cloudflared to the same network (via install.sh)
When you run `install.sh`, it prompts:
```
Docker network for target app [appnet]:
```
Enter `appnet` (or your chosen shared network name).

---

## 4) Point the tunnel to the app container
In `VMs/Cloudflare Tunnel - via Docker/config.yml`:
```yaml
ingress:
  - hostname: app.example.com
    service: http://app:PORT
  - service: http_status:404
```
Use:
- `app` = the app container name (service name in compose)
- `PORT` = the app’s internal port

---

## 5) Verify
From the VM:
```bash
docker network inspect appnet | grep -E 'Name|Containers'
```
You should see both the app container and cloudflared attached to the same network.

---

## Common mistakes
- **Different networks:** cloudflared can’t resolve the app container name.
- **Wrong container name:** use the compose service name, not the image name.
- **Wrong port:** use the app’s internal port, not host-mapped port.
