# Google Drive folder and service account setup design

## Summary
- **Goal:** Define how to prepare a Google Drive folder and service account for backups using a personal Drive.

## Document meta
- **Owner:** TBD
- **Status:** draft
- **Last updated:** 2026-02-01
- **Related docs:** Design/9. github action backup to google drive design.md, Design/10. restore from google drive design.md

## Global Variables (select here)
| **Variable** | **Value** |
| --- | --- |
| **`GDRIVE_FOLDER_NAME`** | TBD |
| **`GDRIVE_FOLDER_ID`** | TBD |
| **`GDRIVE_SERVICE_ACCOUNT_EMAIL`** | TBD |
| **`GDRIVE_AUTH_METHOD`** | Service account JSON |
| **`GDRIVE_SHARED_WITH_SA`** | yes |

## Decisions
| **Decision** | **Rationale** | **Alternatives** | **Impact** |
| --- | --- | --- | --- |
| Use a service account with a shared folder in personal Drive. | Avoids user OAuth tokens and keeps access scoped. | OAuth app with user token. | Requires folder sharing and service account JSON. |
| Store credentials only in GitHub Secrets. | Prevents credential leakage. | Store locally on runner. | Requires secret management in GitHub. |

## Definitions (optional)
- **Service account:** Google Cloud identity used for automated access.
- **Shared folder:** A Drive folder shared explicitly with the service account email.

## Overview
- **Goal:** Create a dedicated Drive folder and grant access to a service account used by CI.
- **Target users:** Repo maintainers and operators.
- **Business value:** Deterministic, least-privilege access for automated backups.

## Scope
- **In scope:** Folder creation; service account creation; sharing permissions; secret storage.
- **Out of scope:** OAuth app setup; Drive API client libraries.
- **Assumptions:** A Google Cloud project is available; personal Drive can share folders.
- **Constraints:** Do not place secrets in the repo.

## Requirements
| **Type** | **Requirement** |
| --- | --- |
| **Functional** | Create a dedicated Drive folder for backups. |
| **Functional** | Create a service account and download JSON key. |
| **Functional** | Share the folder with the service account email. |
| **Functional** | Record `GDRIVE_FOLDER_ID` and store JSON in GitHub Secrets. |
| **Non-functional** | Grant least-privilege access only to the backup folder. |
| **Non-functional** | Do not expose credentials in logs or commits. |

## Architecture
- **Components:** Personal Google Drive; Google Cloud service account; GitHub Secrets.
- **Data flow:** Operator creates folder -> shares with service account -> stores folder ID and JSON in secrets.
- **External dependencies:** Google Cloud Console; Google Drive UI.
- **Deployment model:** Manual setup done once per project.
- **Diagram description:** Personal Drive folder shared with service account; CI uses JSON to access folder.

## Data Design
- **Entities:** Drive folder; service account JSON key; folder ID.
- **Relationships:** Folder shared to service account email; JSON key maps to that account.
- **Storage/retention:** JSON key stored only in GitHub Secrets.

## Security
- **Threats:** Key leakage; overbroad Drive access.
- **Mitigations:** Limit sharing to one folder; rotate keys if exposed.
- **Secrets:** `GDRIVE_SERVICE_ACCOUNT_JSON` stored in GitHub Secrets.

## Observability
- **Logging:** Record folder ID and service account email in docs (no secrets).
- **Metrics:** None.
- **Alerts:** None.

## Testing Strategy
- **Unit:** Validate secrets exist in CI before backup job starts.
- **Integration:** Run a test upload to the shared folder.
- **E2E:** Full backup run writes to the folder and logs success.

## Rollout Plan
- **Milestones:** Create folder; create service account; share folder; store secrets.
- **Rollback:** Revoke sharing and delete/rotate service account key.

## Open Questions and Risks
- **Questions:** Should the folder be in My Drive or a Shared Drive?
- **Risks and mitigations:** Service account key exposure; mitigate with rotation and audit.
