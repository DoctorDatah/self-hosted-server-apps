# Scope Design (Project)

## Summary
- **Goal:** Define the project-wide scope and sequencing for the n8n self-hosting VM deployment.

## Global Variables (select here)
| **Variable** | **Value** |
| --- | --- |
| **`PRIMARY_OS`** | Ubuntu 22.04 LTS |
| **`DEPLOY_RUNTIME`** | Docker Compose |
| **`INGRESS_METHOD`** | Cloudflare Tunnel |
| **`CI_PLATFORM`** | GitHub Actions |
| **`SECRETS_SOURCE`** | Infisical |

## Decisions
| **Decision** | **Rationale** | **Alternatives** | **Impact** |
| --- | --- | --- | --- |
| Use a single VM deployment. | Keep ops simple and deterministic. | Multi-node or HA setup. | Limits scalability and redundancy. |
| Use Cloudflare Tunnel for public access. | Avoid exposing the VM directly. | Direct HTTPS or VPN. | Requires tunnel client and credentials. |
| Use CI-based deployments. | Repeatable, auditable changes. | Manual deployments. | Requires SSH and secret handling. |

## Overview
- **Goal:** Provide a single source of truth for project scope and sequencing.
- **Target users:** VM operator and CI maintainers.
- **Business value:** Clear boundaries and deterministic setup order.

## Scope
- **In scope:** VM bootstrap; container runtime; public ingress; CI deploy; secrets integration.
- **Out of scope:** HA/multi-node; managed databases; monitoring dashboards; user workflow design.
- **Assumptions:** Single VM; repo is source of truth; infra changes are reviewed.
- **Constraints:** Minimal host packages; pinned versions; secrets never stored in repo.

## Requirements
| **Type** | **Requirement** |
| --- | --- |
| **Functional** | Follow the sequence of design docs for setup and deployment. |
| **Functional** | Keep system packages and app dependencies separated. |
| **Non-functional** | All versions are pinned and recorded in repo. |
| **Non-functional** | Secrets are stored only in approved secret stores. |

## Architecture
- **Components:** VM host; Docker engine; Cloudflare Tunnel; GitHub Actions; Infisical.
- **Data flow:** Repo -> CI -> VM -> containers; secrets -> CI -> runtime env.
- **External dependencies:** Cloudflare; GitHub; Infisical.
- **Deployment model:** CI deploys to VM after public access is available.

## Data Design
- **Entities:** Repo configuration; pinned dependency list; secret references.
- **Relationships:** CI uses repo config and secrets to deploy runtime.
- **Storage/retention:** Repo history for configs; secrets in external store only.

## Security
- **Threats:** Secret leakage; host drift; unpinned dependencies.
- **Mitigations:** CI secrets; pinned versions; minimal host footprint.
- **Secrets:** CI secrets and Infisical tokens only.

## Observability
- **Logging:** Container logs and CI logs.
- **Metrics:** Container health only.
- **Alerts:** Not implemented; manual checks.

## Testing Strategy
- **Unit:** Validate config and pin files exist and are consistent.
- **Integration:** End-to-end deploy to VM using CI.
- **E2E:** Verify public access and SSH via tunnel.

## Rollout Plan
- **Milestones:** Package handling -> Cloudflare -> pinning -> SSH -> Infisical -> CI deploy.
- **Rollback:** Revert repo changes and redeploy previous pinned versions.

## Open Questions and Risks
- **Questions:** Do we need a staging VM for pre-prod validation?
- **Risks and mitigations:** Single VM failure -> add backups and restore steps.
