# Cloudflare Tunnel -> App Container Network Guide

Use this when cloudflared runs in one container and your app runs in another container/stack.

## Goal
Let cloudflared reach the app over Docker networking so the tunnel serves the app.

---

## 1) Create a shared Docker network (once)
Run on the VM:
```bash
docker network create n8n
```

---

## 2) Attach your app container to that network
In the app’s `docker-compose.yml`:
```yaml
networks:
  n8n:
    external: true

services:
  n8n:
    networks:
      - n8n
```
Replace `n8n` with your app service name if different.

---

## 3) Attach cloudflared to the same network
In `Apps/cloudflare/docker-compose.yml`:
```yaml
networks:
  n8n:
    external: true

services:
  cloudflared:
    networks:
      - n8n
```

---

## 4) Point the tunnel to the app container
In `Apps/cloudflare/config.yml`:
```yaml
ingress:
  - hostname: n8n.example.com
    service: http://n8n:5678
  - service: http_status:404
```
Use:
- `n8n` = the app container name (service name in compose)
- `5678` = the app’s internal port

---

## 5) Verify
From the VM:
```bash
docker network inspect n8n | grep -E 'Name|Containers'
```
You should see both the app container and cloudflared attached to the same network.

---

## Common mistakes
- **Different networks:** cloudflared can’t resolve the app container name.
- **Wrong container name:** use the compose service name, not the image name.
- **Wrong port:** use the app’s internal port, not host-mapped port.
