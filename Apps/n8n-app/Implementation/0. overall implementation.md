# Overall Implementation

| **Step ID** | **Step** | **Source design doc** | **Inputs** | **Outputs** | **Execution context** | **Execution location** | **Implementation status** | **AI touchbase** | **Remarks** |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | Confirm project-wide variables: `PRIMARY_OS`, `DEPLOY_RUNTIME`, `INGRESS_METHOD`, `CI_PLATFORM`, `SECRETS_SOURCE`. | Design/0. scope.md | Design/0. scope.md | Selected global values | Repo planning | Local (planning) | pending | must |  |
| 2 | Create repo folder structure under `ops/`, `.github/workflows/`, and `Design/` per the canonical layout. | Design/11. implementation structure design.md | Repo root | Required directories present | Repo | Local (repo) | done | must |  |
| 3 | Create `ops/dependencies.md` as the single source of truth for pinned versions. | Design/11. implementation structure design.md | Repo root | `ops/dependencies.md` | Repo | Local (repo) | done | must |  |
| 4 | Record pinned versions for `CLOUDFLARE_IMAGE_TAG`, `CLOUDFLARE_CLIENT_VERSION`, `N8N_IMAGE_TAG`, `POSTGRES_IMAGE_TAG`, and `INFISICAL_CLI_VERSION`. | Design/3. gh repo cloudflare pinned version.md, Design/6.2 gh action deploy script install cloudflare.md, Design/7. n8n deployment design.md, Design/6.1 gh action infisical install and secret fetch.md | `ops/dependencies.md` | Updated pin table | Repo | Local (repo) | pending | must |  |
| 5 | Confirm `SUPPORTED_OS` and `PRIMARY_OS` for host setup. | Design/1. package handling design.md | Design/1. package handling design.md | Selected OS values | Repo planning | Local (planning) | pending | must |  |
| 6 | Select `DOCKER_APT_REPO` based on `PRIMARY_OS`. | Design/1. package handling design.md | Design/1. package handling design.md | Selected Docker repo URL | Repo planning | Local (planning) | pending | must |  |
| 7 | Create `ops/system-packages.txt`. | Design/1. package handling design.md | Repo root | `ops/system-packages.txt` | Repo | Local (repo) | done | must |  |
| 8 | Populate `ops/system-packages.txt` with required host packages. | Design/1. package handling design.md | `ops/system-packages.txt` | Updated package list | Repo | Local (repo) | pending | flexible |  |
| 9 | Create `ops/package-audit.md` for host and app package audit notes. | Design/1. package handling design.md | Repo root | `ops/package-audit.md` | Repo | Local (repo) | done | must |  |
| 10 | Install Docker Engine and Compose from the official repo using `DOCKER_KEYRING_PATH`. | Design/1. package handling design.md | `DOCKER_APT_REPO`, `DOCKER_KEYRING_PATH` | Docker Engine and Compose installed | VM | VM | pending | flexible |  |
| 11 | Configure Docker log rotation per `LOG_RETENTION_STRATEGY`. | Design/1. package handling design.md | `/etc/docker/daemon.json` | Log rotation configured | VM | VM | pending | flexible |  |
| 12 | Create `ops/cloudflared/config.yml` with non-secret settings only. | Design/2. cloudflare installation design.md | Repo root | `ops/cloudflared/config.yml` | Repo | Local (repo) | done | must |  |
| 13 | Create `ops/compose/cloudflared.compose.yml` that uses `CLOUDFLARE_IMAGE` and `CLOUDFLARE_IMAGE_TAG` from `ops/dependencies.md`. | Design/2. cloudflare installation design.md, Design/3. gh repo cloudflare pinned version.md | `ops/dependencies.md` | `ops/compose/cloudflared.compose.yml` | Repo | Local (repo) | done | must |  |
| 14 | Copy `ops/cloudflared/config.yml` to the VM and verify its checksum matches the repo file. | Design/2. cloudflare installation design.md | `ops/cloudflared/config.yml` | Verified VM config | VM | VM | pending | flexible |  |
| 15 | Inject the Cloudflare tunnel token in-session and start the cloudflared container via Compose. | Design/2. cloudflare installation design.md | Tunnel token, `ops/compose/cloudflared.compose.yml` | Running cloudflared container | VM | VM | pending | flexible |  |
| 16 | Create `ops/ssh/known_hosts`. | Design/4. ssh setup design.md | Repo root | `ops/ssh/known_hosts` | Repo | Local (repo) | done | must |  |
| 17 | Create `SSH_USER`, install its public key, and disable password auth in SSH server config. | Design/4. ssh setup design.md | VM SSH config | `SSH_USER` configured | VM | VM | pending | flexible |  |
| 18 | Record the VM host key fingerprint in `ops/ssh/known_hosts`. | Design/4. ssh setup design.md | VM host key | Updated `ops/ssh/known_hosts` | VM and repo | VM + Local (repo) | pending | must |  |
| 19 | Store the SSH private key in GitHub Actions secrets. | Design/4. ssh setup design.md | GitHub repo settings | `SSH_PRIVATE_KEY_SOURCE` set | GitHub repo settings | GitHub (web) | pending | must |  |
| 20 | Define GitHub variables `INFISICAL_ENV`, `INFISICAL_PATH`, and `INFISICAL_PROJECT_ID`. | Design/5. gh variables and secrets for infisical.md | GitHub repo settings | GitHub variables set | GitHub repo settings | GitHub (web) | pending | must |  |
| 21 | Define GitHub secret `INFISICAL_TOKEN`. | Design/5. gh variables and secrets for infisical.md | GitHub repo settings | GitHub secret set | GitHub repo settings | GitHub (web) | pending | must |  |
| 22 | Create `ops/secrets/infisical.md` with references to required secret keys (no secret values). | Design/11. implementation structure design.md | Repo root | `ops/secrets/infisical.md` | Repo | Local (repo) | done | flexible |  |
| 23 | Create `ops/compose/n8n.compose.yml` with pinned `N8N_IMAGE_TAG` and `POSTGRES_IMAGE_TAG` from `ops/dependencies.md`. | Design/7. n8n deployment design.md | `ops/dependencies.md` | `ops/compose/n8n.compose.yml` | Repo | Local (repo) | done | must |  |
| 24 | Create VM data directories at `N8N_DATA_PATH` and `POSTGRES_DATA_PATH`. | Design/7. n8n deployment design.md | VM filesystem | Persisted data directories | VM | VM | pending | flexible |  |
| 25 | Create `ops/deploy/validate-env.sh` to assert required CI env vars exist before deploy. | Design/11. implementation structure design.md | Repo root | `ops/deploy/validate-env.sh` | Repo | Local (repo) | done | flexible |  |
| 26 | Create `ops/deploy/deploy.sh` to run Compose deploys on the VM. | Design/11. implementation structure design.md, Design/7. n8n deployment design.md | Repo root | `ops/deploy/deploy.sh` | Repo | Local (repo) | done | flexible |  |
| 27 | Create `.github/workflows/deploy.yml` with a step to install Infisical CLI at `INFISICAL_CLI_VERSION`. | Design/6.1 gh action infisical install and secret fetch.md | `.github/workflows/` | Updated deploy workflow | Repo | Local (repo) | done | flexible |  |
| 28 | Add workflow steps to authenticate to Infisical and fetch `CLOUDFLARE_CLIENT_ID` and `CLOUDFLARE_CLIENT_SECRET` into `CLOUDFLARE_CREDS_OUTPUT`. | Design/6.1 gh action infisical install and secret fetch.md | GitHub variables/secrets | Cloudflare creds available to deploy | Repo | Local (repo) | done | flexible |  |
| 29 | Add workflow steps to install `CLOUDFLARE_CLIENT_TOOL` at `CLOUDFLARE_CLIENT_VERSION` and SSH via `CLOUDFLARE_TUNNEL_ENDPOINT`. | Design/6.2 gh action deploy script install cloudflare.md | `ops/dependencies.md`, GitHub variables | Tunnel-based SSH connection | Repo | Local (repo) | done | flexible |  |
| 30 | Configure the workflow to use `ops/ssh/known_hosts` and the SSH private key for non-interactive SSH. | Design/4. ssh setup design.md | `ops/ssh/known_hosts`, GitHub secret | Verified SSH connection | Repo | Local (repo) | done | flexible |  |
| 31 | Run the deploy workflow to bring up the cloudflared, n8n, and Postgres services via Compose. | Design/7. n8n deployment design.md | `ops/compose/*.compose.yml` | Running containers | GitHub Actions runner | GitHub Actions runner | pending | flexible |  |
| 32 | Record host and app package decisions in `ops/package-audit.md`. | Design/1. package handling design.md | `ops/package-audit.md` | Updated audit log | Repo | Local (repo) | pending | must |  |
| 33 | Create a dedicated Google Drive folder for backups and record its ID in repo notes. | Design/8. google drive folder and service account setup design.md | Google Drive UI | `GDRIVE_FOLDER_ID` | Repo planning | Local (planning) | pending | flexible |  |
| 34 | Create a Google Cloud service account for Drive access and download JSON key. | Design/8. google drive folder and service account setup design.md | Google Cloud Console | Service account JSON | Google Cloud Console | Web console | pending | flexible |  |
| 35 | Share the backup folder with the service account email and confirm access. | Design/8. google drive folder and service account setup design.md | `GDRIVE_SERVICE_ACCOUNT_EMAIL`, Drive folder | Shared folder access | Google Drive UI | Web console | pending | flexible |  |
| 36 | Store `GDRIVE_SERVICE_ACCOUNT_JSON` and `GDRIVE_FOLDER_ID` in GitHub Secrets/Variables. | Design/8. google drive folder and service account setup design.md | GitHub repo settings | Secrets/variables set | GitHub repo settings | GitHub (web) | pending | flexible |  |
| 37 | Define backup targets, schedule, retention, and checksum settings in the backup design doc. | Design/9. github action backup to google drive design.md | Design/9. github action backup to google drive design.md | Finalized backup variables | Repo planning | Local (planning) | pending | flexible |  |
| 38 | Create `.github/workflows/backup.yml` using rclone and the Drive credentials. | Design/9. github action backup to google drive design.md | `.github/workflows/` | `backup.yml` workflow | Repo | Local (repo) | done | flexible |  |
| 39 | Add retention cleanup logic and checksum verification to the backup workflow. | Design/9. github action backup to google drive design.md | `backup.yml` | Retention and checksum steps | Repo | Local (repo) | done | flexible |  |
| 40 | Define restore target, source ID, and dry-run behavior in the restore design doc. | Design/10. restore from google drive design.md | Design/10. restore from google drive design.md | Finalized restore variables | Repo planning | Local (planning) | pending | flexible |  |
| 41 | Create `.github/workflows/restore.yml` to download, verify, and restore artifacts. | Design/10. restore from google drive design.md | `.github/workflows/` | `restore.yml` workflow | Repo | Local (repo) | done | flexible |  |
